Build_Player_With_Tests_Android:
  name: Build Players with tests Android
  agent:
      type: Unity::VM
      image: mobile/android-execution-r19:stable
      flavor: b1.xlarge
      
  commands:
    # Download unity-downloader-cli
    - pip install unity-downloader-cli --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple
    - git clone git@github.cds.internal.unity3d.com:unity/utr.git utr
    - unity-downloader-cli -u 2020.2 -p WindowsEditor -c editor -c Android --wait --fast 
   # - curl -s https://artifactory.internal.unity3d.com/core-automation/tools/utr-standalone/utr-staging.bat --output utr.bat
   # - |
   #   mklink /D .Editor\Data\PlaybackEngines\AndroidPlayer\NDK %ANDROID_NDK_ROOT%
   #   mklink /D .Editor\Data\PlaybackEngines\AndroidPlayer\OpenJDK %JAVA_HOME%
   #   mklink /D .Editor\Data\PlaybackEngines\AndroidPlayer\SDK %ANDROID_SDK_ROOT%
    - utr\utr --suite=playmode --platform=Android --editor-location=WindowsEditor --testproject=WinterPPv3 --player-save-path=build/players --artifacts_path=build/logs --scripting-backend=mono --build-only || exit 0
  artifacts:
    players:
        paths:
          - "build/players/**"
    logs:
        paths:
          - "build/logs/**"

Run_Player_With_Tests_Android:
  name: Run Tests with built player Android
  agent:
      type: Unity::mobile::shield
      image: mobile/android-execution-r19:stable
      flavor: b1.medium
  skip_checkout: true
  dependencies:
    - .yamato/buildTestsYamato.yml#Build_Player_With_Tests_Android    
  commands: 
    - |
      curl -s https://artifactory.internal.unity3d.com/core-automation/tools/utr-standalone/utr-staging.bat --output utr.bat
      set ANDROID_DEVICE_CONNECTION=%BOKKEN_DEVICE_IP%
      ./utr --suite=playmode --platform=android --player-load-path=build/players --artifacts_path=test-results --scripting-backend=il2cpp
  after:
    - pip install requests --index-url https://artifactory.prd.it.unity3d.com/artifactory/api/pypi/pypi/simple
    - git clone git@github.com:Unity-Technologies/utr-tracker.git 
    - python utr-tracker/utr-tracker.py NIVGYLK
  artifacts:
    logs:
      paths:
        - "**/test-results/**"
